[틀림] 날짜를 계산할 때에는 꼭 DATEDIFF 을 사용해야한다.


```
SELECT 
    HISTORY_ID, 
    CAST(
        CASE
        WHEN DISCOUNT_RATE IS NOT NULL THEN DAYS*DAILY_FEE * (100 - DISCOUNT_RATE) / 100
        ELSE DAYS*DAILY_FEE
        END AS SIGNED
    ) AS FEE
FROM
(
    SELECT CAR_TYPE, HISTORY_ID, CAR_ID, DATEDIFF(END_DATE,START_DATE)+1 AS DAYS, DAILY_FEE, 
    CASE 
        WHEN DATEDIFF(END_DATE,START_DATE)+1 >= 90 THEN '90일 이상'
        WHEN DATEDIFF(END_DATE,START_DATE)+1 >= 30 THEN '30일 이상'
        WHEN DATEDIFF(END_DATE,START_DATE)+1 >= 7 THEN '7일 이상'
        WHEN DATEDIFF(END_DATE,START_DATE)+1 >= 0 THEN '0일 이상'
    END as DURATION_TYPE
    FROM 
        CAR_RENTAL_COMPANY_RENTAL_HISTORY AS A
    JOIN CAR_RENTAL_COMPANY_CAR AS B
        USING (CAR_ID)
    WHERE CAR_TYPE='트럭'
) AS C
LEFT JOIN CAR_RENTAL_COMPANY_DISCOUNT_PLAN as D
ON C.CAR_TYPE=D.CAR_TYPE and C.DURATION_TYPE=D.DURATION_TYPE
ORDER BY FEE DESC, HISTORY_ID DESC
```


서브쿼리 없는 버전
```
-- 코드를 입력하세요
SELECT HISTORY_ID, 
CASE
    WHEN DISCOUNT_RATE IS NOT NULL 
        THEN CAST(
            DAILY_FEE * 
            (DATEDIFF(END_DATE, START_DATE)+1) * 
            (100-discount_rate) / 100 
            AS SIGNED
        )
    ELSE 
        DAILY_FEE * (DATEDIFF(END_DATE, START_DATE)+1)
END AS FEE
FROM
    CAR_RENTAL_COMPANY_RENTAL_HISTORY AS H
JOIN
    CAR_RENTAL_COMPANY_CAR AS C
    USING (CAR_ID)
LEFT JOIN
    CAR_RENTAL_COMPANY_DISCOUNT_PLAN AS P
ON
    C.CAR_TYPE=P.CAR_TYPE AND
    P.DURATION_TYPE=
        CASE 
            WHEN DATEDIFF(END_DATE, START_DATE)+1 >= 90 THEN '90일 이상'
            WHEN DATEDIFF(END_DATE, START_DATE)+1 >= 30 THEN '30일 이상'
            WHEN DATEDIFF(END_DATE, START_DATE)+1 >= 7 THEN '7일 이상'
        END
WHERE
    C.CAR_TYPE='트럭'
ORDER BY
    FEE DESC,
    HISTORY_ID DESC
```